{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema proprietà — Porte HPL",
  "type": "object",
  "required": ["category", "properties"],
  "properties": {
    "category": {"const": "porte_hpl"},
    "properties": {
      "type": "object",
      "required": ["larghezza_anta_mm", "altezza_anta_mm", "classe_rei"],
      "properties": {
        "larghezza_anta_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 600, "maximum": 1600},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "altezza_anta_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 1800, "maximum": 3000},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "spessore_anta_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 30, "maximum": 80},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "classe_rei": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["REI30", "REI60", "REI90", "REI120"]}
              }
            }
          ]
        },
        "finitura_superficie": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "minLength": 3, "maxLength": 40}
              }
            }
          ]
        },
        "materiale_telaio": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["alluminio", "acciaio", "legno", "pvc"]}
              }
            }
          ]
        },
        "dotazione_accessori": {
          "allOf": [
            {"$ref": "#/$defs/list_value"},
            {
              "properties": {
                "value": {
                  "type": "array",
                  "items": {"type": "string", "minLength": 2, "maxLength": 80},
                  "minItems": 1,
                  "maxItems": 5
                }
              }
            }
          ]
        },
        "marchio": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "minLength": 2, "maxLength": 80}
              }
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "base": {
      "type": "object",
      "required": ["value", "source", "span", "confidence"],
      "properties": {
        "value": {},
        "unit": {"type": ["string", "null"]},
        "raw": {"type": ["string", "null"]},
        "source": {"type": "string", "enum": ["parser", "matcher", "qa_llm", "fuse"]},
        "span": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
        "evidence": {"type": ["string", "null"]},
        "validation": {"type": "object"}
      },
      "additionalProperties": false
    },
    "measurement": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "number"}}}
      ]
    },
    "value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "string", "minLength": 1}}}
      ]
    },
    "list_value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "array"}}}
      ]
    }
  }
}
