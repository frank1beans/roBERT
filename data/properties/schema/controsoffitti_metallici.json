{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema proprietà — Controsoffitti metallici",
  "type": "object",
  "required": ["category", "properties"],
  "properties": {
    "category": {"const": "controsoffitti_metallici"},
    "properties": {
      "type": "object",
      "required": ["tipologia_modulo", "dimensione_modulo_mm", "materiale_pannello"],
      "properties": {
        "tipologia_modulo": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["doghe", "pannelli", "grigliato"]}
              }
            }
          ]
        },
        "dimensione_modulo_mm": {
          "allOf": [
            {"$ref": "#/$defs/list_value"},
            {
              "properties": {
                "value": {
                  "type": "array",
                  "items": {"type": "number", "minimum": 50, "maximum": 2000},
                  "minItems": 2,
                  "maxItems": 3
                },
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "materiale_pannello": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["acciaio", "alluminio", "acciaio_microforato"]}
              }
            }
          ]
        },
        "trattamento_superficiale": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["verniciato", "anodizzato", "polveri_epossidiche"]}
              }
            }
          ]
        },
        "prestazione_acustica_db": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 20, "maximum": 50},
                "unit": {"const": "db"}
              }
            }
          ]
        },
        "classe_reazione_fuoco": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["A1", "A2", "B-s1,d0"]}
              }
            }
          ]
        },
        "spessore_pannello_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 0.4, "maximum": 1.2},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "standard_riferimento": {
          "allOf": [
            {"$ref": "#/$defs/list_value"},
            {
              "properties": {
                "value": {
                  "type": "array",
                  "items": {"type": "string", "minLength": 4, "maxLength": 40},
                  "minItems": 0,
                  "maxItems": 6
                }
              }
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "base": {
      "type": "object",
      "required": ["value", "source", "span", "confidence"],
      "properties": {
        "value": {},
        "unit": {"type": ["string", "null"]},
        "raw": {"type": ["string", "null"]},
        "source": {"type": "string", "enum": ["parser", "matcher", "qa_llm", "fuse"]},
        "span": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
        "evidence": {"type": ["string", "null"]},
        "validation": {"type": "object"}
      },
      "additionalProperties": false
    },
    "measurement": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "number"}}}
      ]
    },
    "value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "string", "minLength": 1}}}
      ]
    },
    "list_value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "array"}}}
      ]
    }
  }
}
