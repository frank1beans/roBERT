{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema proprietà — Opere da cartongessista",
  "type": "object",
  "required": ["category", "properties"],
  "properties": {
    "category": {"const": "opere_da_cartongessista"},
    "properties": {
      "type": "object",
      "required": ["tipologia_lastra", "spessore_mm", "classe_reazione_al_fuoco"],
      "properties": {
        "marchio": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {"properties": {"value": {"type": "string", "minLength": 2, "maxLength": 80}}}
          ]
        },
        "tipologia_lastra": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {
                  "type": "string",
                  "enum": ["standard", "idrofuga", "ignifuga", "acustica", "fibrogesso", "accoppiata_isolante"]
                }
              }
            }
          ]
        },
        "spessore_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 6, "maximum": 100},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "classe_ei": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {
                  "type": "string",
                  "enum": ["EI30", "EI45", "EI60", "EI90", "EI120", "EI180"]
                }
              }
            }
          ]
        },
        "classe_reazione_al_fuoco": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {
                  "type": "string",
                  "enum": ["A1", "A2-s1,d0", "A2-s2,d0", "B-s1,d0", "B-s2,d0"]
                }
              }
            }
          ]
        },
        "presenza_isolante": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {"properties": {"value": {"type": "string", "enum": ["si", "no"]}}}
          ]
        },
        "stratigrafia_lastre": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "minLength": 5, "maxLength": 400}
              }
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "base": {
      "type": "object",
      "required": ["value", "source", "span", "confidence"],
      "properties": {
        "value": {},
        "unit": {"type": ["string", "null"]},
        "raw": {"type": ["string", "null"]},
        "source": {"type": "string", "enum": ["parser", "matcher", "qa_llm", "fuse"]},
        "span": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
        "evidence": {"type": ["string", "null"]},
        "validation": {"type": "object"}
      },
      "additionalProperties": false
    },
    "measurement": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "number"}}}
      ]
    },
    "value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": ["string", "number", "boolean"]}}}
      ]
    }
  }
}
