{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema proprietà — Pavimenti sopraelevati",
  "type": "object",
  "required": ["category", "properties"],
  "properties": {
    "category": {"const": "pavimenti_sopraelevati"},
    "properties": {
      "type": "object",
      "required": ["spessore_pannello_mm", "carico_utile_kn_m2", "rivestimento_superiore"],
      "properties": {
        "spessore_pannello_mm": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 25, "maximum": 60},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "altezza_struttura_regolabile_mm": {
          "allOf": [
            {"$ref": "#/$defs/list_value"},
            {
              "properties": {
                "value": {
                  "type": "array",
                  "items": {"type": "number", "minimum": 0, "maximum": 2000},
                  "minItems": 2,
                  "maxItems": 2
                },
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "carico_utile_kn_m2": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 2.0, "maximum": 10.0},
                "unit": {"const": "kn/m2"}
              }
            }
          ]
        },
        "rivestimento_superiore": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["gres", "laminato", "pvc", "moquette"]}
              }
            }
          ]
        },
        "materiale_nucleo": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["solfato_calcio", "truciolare", "alluminio"]}
              }
            }
          ]
        },
        "classe_reazione_fuoco": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "enum": ["Bfl-s1", "Cfl-s1"]}
              }
            }
          ]
        },
        "resistenza_umidita_percent": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 0, "maximum": 100},
                "unit": {"const": "%"}
              }
            }
          ]
        },
        "marchio": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {"type": "string", "minLength": 2, "maxLength": 80}
              }
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "base": {
      "type": "object",
      "required": ["value", "source", "span", "confidence"],
      "properties": {
        "value": {},
        "unit": {"type": ["string", "null"]},
        "raw": {"type": ["string", "null"]},
        "source": {"type": "string", "enum": ["parser", "matcher", "qa_llm", "fuse"]},
        "span": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
        "evidence": {"type": ["string", "null"]},
        "validation": {"type": "object"}
      },
      "additionalProperties": false
    },
    "measurement": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "number"}}}
      ]
    },
    "value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "string", "minLength": 1}}}
      ]
    },
    "list_value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "array"}}}
      ]
    }
  }
}
