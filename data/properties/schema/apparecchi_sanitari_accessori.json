{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema proprietà — Apparecchi sanitari e accessori",
  "type": "object",
  "required": ["category", "properties"],
  "properties": {
    "category": {"const": "apparecchi_sanitari_accessori"},
    "properties": {
      "type": "object",
      "required": ["materiale", "dimensione_lunghezza", "dimensione_larghezza", "dimensione_altezza", "tipologia_installazione"],
      "properties": {
        "marchio": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {"properties": {"value": {"type": "string", "minLength": 2, "maxLength": 80}}}
          ]
        },
        "materiale": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {
                  "type": "string",
                  "enum": ["ceramica", "acciaio_inox", "resina", "vetro", "ghisa", "porcellana"]
                }
              }
            }
          ]
        },
        "dimensione_lunghezza": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 150, "maximum": 2500},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "dimensione_larghezza": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 150, "maximum": 1500},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "dimensione_altezza": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 100, "maximum": 2000},
                "unit": {"const": "mm"}
              }
            }
          ]
        },
        "tipologia_installazione": {
          "allOf": [
            {"$ref": "#/$defs/value"},
            {
              "properties": {
                "value": {
                  "type": "string",
                  "enum": ["a_pavimento", "a_parete", "sospesa", "incasso"]
                }
              }
            }
          ]
        },
        "portata_l_min": {
          "allOf": [
            {"$ref": "#/$defs/measurement"},
            {
              "properties": {
                "value": {"type": "number", "minimum": 0.0, "maximum": 60.0},
                "unit": {"const": "l/min"}
              }
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "base": {
      "type": "object",
      "required": ["value", "source", "span", "confidence"],
      "properties": {
        "value": {},
        "unit": {"type": ["string", "null"]},
        "raw": {"type": ["string", "null"]},
        "source": {"type": "string", "enum": ["parser", "matcher", "qa_llm", "fuse"]},
        "span": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
        "evidence": {"type": ["string", "null"]},
        "validation": {"type": "object"}
      },
      "additionalProperties": false
    },
    "measurement": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": "number"}}}
      ]
    },
    "value": {
      "allOf": [
        {"$ref": "#/$defs/base"},
        {"properties": {"value": {"type": ["string", "number", "boolean"]}}}
      ]
    }
  }
}
